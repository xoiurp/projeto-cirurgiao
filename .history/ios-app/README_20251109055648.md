# ğŸ“± CirurgiaoApp - iOS

Aplicativo iOS nativo do Projeto CirurgiÃ£o desenvolvido em Swift 5.9 + SwiftUI.

## ğŸ“‹ Ãndice

- [VisÃ£o Geral](#visÃ£o-geral)
- [Requisitos](#requisitos)
- [InstalaÃ§Ã£o](#instalaÃ§Ã£o)
- [Arquitetura](#arquitetura)
- [Estrutura do Projeto](#estrutura-do-projeto)
- [Funcionalidades](#funcionalidades)
- [Testes](#testes)
- [ConfiguraÃ§Ã£o](#configuraÃ§Ã£o)
- [API Integration](#api-integration)

## ğŸ¯ VisÃ£o Geral

Aplicativo iOS para o sistema de gestÃ£o cirÃºrgica, implementando autenticaÃ§Ã£o completa e dashboard inicial.

### Stack TecnolÃ³gica

- **Swift**: 5.9
- **UI Framework**: SwiftUI
- **Arquitetura**: MVVM (Model-View-ViewModel)
- **Async**: async/await + Combine
- **Networking**: URLSession
- **Storage**: Keychain
- **Analytics**: Firebase Analytics
- **Crash Reporting**: Firebase Crashlytics
- **Minimum iOS**: 16.0

## ğŸ“¦ Requisitos

- Xcode 15.0+
- iOS 16.0+
- macOS 13.0+ (para desenvolvimento)
- Swift 5.9+
- CocoaPods ou Swift Package Manager

## ğŸš€ InstalaÃ§Ã£o

### 1. Clone o RepositÃ³rio

```bash
cd ios-app
```

### 2. Instalar DependÃªncias

O projeto usa Swift Package Manager. As dependÃªncias serÃ£o baixadas automaticamente ao abrir o projeto no Xcode.

**DependÃªncias:**
- Firebase iOS SDK (Analytics, Crashlytics, Auth)

### 3. Configurar Firebase

O arquivo `GoogleService-Info.plist` jÃ¡ estÃ¡ incluÃ­do em:
```
ios-app/CirurgiaoApp/Resources/GoogleService-Info.plist
```

### 4. Abrir no Xcode

```bash
open CirurgiaoApp.xcodeproj
```

Ou use o Package.swift:
```bash
xed .
```

### 5. Configurar Backend URL

Por padrÃ£o, o app aponta para `http://localhost:3000`. Para alterar:

Edite `ios-app/CirurgiaoApp/Core/Network/APIClient.swift`:

```swift
private init() {
    self.baseURL = "http://localhost:3000" // Altere aqui
    // ...
}
```

### 6. Build e Run

1. Selecione um simulador ou dispositivo
2. Pressione `Cmd + R` ou clique em "Run"

## ğŸ—ï¸ Arquitetura

### MVVM Pattern

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    View     â”‚ â† SwiftUI Views
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ViewModel  â”‚ â† Business Logic + State
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Model    â”‚ â† Data Models
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Services   â”‚ â† API, Storage, etc.
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Camadas

1. **Views**: Interface do usuÃ¡rio (SwiftUI)
2. **ViewModels**: LÃ³gica de apresentaÃ§Ã£o e estado
3. **Models**: Estruturas de dados
4. **Services**: ServiÃ§os (API, Keychain, etc.)

## ğŸ“ Estrutura do Projeto

```
ios-app/
â”œâ”€â”€ CirurgiaoApp/
â”‚   â”œâ”€â”€ App/
â”‚   â”‚   â”œâ”€â”€ CirurgiaoAppApp.swift      # Entry point
â”‚   â”‚   â””â”€â”€ ContentView.swift          # Root view
â”‚   â”‚
â”‚   â”œâ”€â”€ Features/
â”‚   â”‚   â”œâ”€â”€ Auth/
â”‚   â”‚   â”‚   â”œâ”€â”€ Models/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ User.swift         # User model
â”‚   â”‚   â”‚   â”œâ”€â”€ ViewModels/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ AuthViewModel.swift
â”‚   â”‚   â”‚   â””â”€â”€ Views/
â”‚   â”‚   â”‚       â”œâ”€â”€ LoginView.swift
â”‚   â”‚   â”‚       â”œâ”€â”€ RegisterView.swift
â”‚   â”‚   â”‚       â””â”€â”€ ForgotPasswordView.swift
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ Dashboard/
â”‚   â”‚       â””â”€â”€ Views/
â”‚   â”‚           â””â”€â”€ DashboardView.swift
â”‚   â”‚
â”‚   â”œâ”€â”€ Core/
â”‚   â”‚   â”œâ”€â”€ Network/
â”‚   â”‚   â”‚   â””â”€â”€ APIClient.swift        # HTTP client
â”‚   â”‚   â””â”€â”€ Storage/
â”‚   â”‚       â””â”€â”€ KeychainManager.swift  # Secure storage
â”‚   â”‚
â”‚   â””â”€â”€ Resources/
â”‚       â”œâ”€â”€ Info.plist
â”‚       â””â”€â”€ GoogleService-Info.plist
â”‚
â”œâ”€â”€ CirurgiaoAppTests/
â”‚   â””â”€â”€ AuthViewModelTests.swift       # Unit tests
â”‚
â”œâ”€â”€ Package.swift                       # SPM dependencies
â””â”€â”€ README.md
```

## âœ¨ Funcionalidades

### âœ… Implementadas (Semana 2)

#### AutenticaÃ§Ã£o
- [x] Login com email/senha
- [x] Registro de novos usuÃ¡rios
- [x] RecuperaÃ§Ã£o de senha
- [x] Logout
- [x] PersistÃªncia de sessÃ£o (Keychain)
- [x] Refresh token automÃ¡tico

#### Dashboard
- [x] Tela inicial pÃ³s-login
- [x] ExibiÃ§Ã£o de informaÃ§Ãµes do usuÃ¡rio
- [x] Cards de funcionalidades
- [x] NavegaÃ§Ã£o condicional

#### SeguranÃ§a
- [x] Tokens salvos no Keychain
- [x] HTTPS/HTTP configurÃ¡vel
- [x] ValidaÃ§Ã£o de formulÃ¡rios

### ğŸ”œ PrÃ³ximas Funcionalidades (Semana 3+)

- [ ] Agendamentos
- [ ] Lista de pacientes
- [ ] Perfil do usuÃ¡rio
- [ ] NotificaÃ§Ãµes push
- [ ] Modo offline
- [ ] Biometria (Face ID / Touch ID)

## ğŸ§ª Testes

### Executar Testes

```bash
# Via Xcode
Cmd + U

# Via linha de comando
xcodebuild test -scheme CirurgiaoApp -destination 'platform=iOS Simulator,name=iPhone 15'
```

### Cobertura de Testes

- âœ… AuthViewModel
- âœ… KeychainManager
- âœ… User Model
- âœ… API Client (parcial)

### Testes Implementados

```swift
// AuthViewModel
- testInitialState()
- testLoginWithEmptyCredentials()
- testLogout()

// KeychainManager
- testSaveAndRetrieveAccessToken()
- testDeleteAllTokens()
- testOverwriteToken()

// User Model
- testUserDecoding()
- testUserRoleDecoding()
```

## âš™ï¸ ConfiguraÃ§Ã£o

### Info.plist

ConfiguraÃ§Ãµes importantes:

```xml
<!-- Permitir HTTP para localhost -->
<key>NSAppTransportSecurity</key>
<dict>
    <key>NSAllowsArbitraryLoads</key>
    <true/>
</dict>

<!-- Bundle ID -->
<key>CFBundleIdentifier</key>
<string>com.projeto-cirurgiao.app</string>
```

### Firebase

Configurado automaticamente no `CirurgiaoAppApp.swift`:

```swift
init() {
    FirebaseApp.configure()
}
```

## ğŸ”Œ API Integration

### Endpoints Utilizados

```swift
// AutenticaÃ§Ã£o
POST /auth/login
POST /auth/register
POST /auth/refresh
GET  /auth/me
POST /auth/logout
```

### Exemplo de Uso

```swift
// Login
await authViewModel.login(
    email: "user@example.com",
    password: "password123"
)

// Registro
await authViewModel.register(
    email: "new@example.com",
    password: "password123",
    name: "Nome Completo",
    role: .patient
)

// Logout
await authViewModel.logout()
```

### Headers

```
Content-Type: application/json
Authorization: Bearer {access_token}  // Para rotas protegidas
```

## ğŸ” SeguranÃ§a

### Keychain

Tokens sÃ£o armazenados de forma segura:

```swift
// Salvar
try KeychainManager.shared.saveAccessToken(token)

// Recuperar
let token = KeychainManager.shared.getAccessToken()

// Deletar
try KeychainManager.shared.deleteAllTokens()
```

### ValidaÃ§Ãµes

- Email: formato vÃ¡lido
- Senha: mÃ­nimo 6 caracteres
- Campos obrigatÃ³rios
- ConfirmaÃ§Ã£o de senha

## ğŸ“± NavegaÃ§Ã£o

### Fluxo de AutenticaÃ§Ã£o

```
ContentView
    â”œâ”€ isAuthenticated = false â†’ LoginView
    â”‚                              â”œâ”€ RegisterView
    â”‚                              â””â”€ ForgotPasswordView
    â”‚
    â””â”€ isAuthenticated = true  â†’ DashboardView
```

### NavegaÃ§Ã£o Condicional

```swift
@EnvironmentObject var authViewModel: AuthViewModel

if authViewModel.isAuthenticated {
    DashboardView()
} else {
    LoginView()
}
```

## ğŸ› Debug

### Logs

O app usa `print()` para logs de desenvolvimento:

```swift
print("âœ… Login realizado com sucesso")
print("âŒ Erro no login: \(error)")
print("ğŸ“§ Email de recuperaÃ§Ã£o enviado")
```

### Breakpoints

Pontos importantes para debug:
- `AuthViewModel.login()`
- `APIClient.request()`
- `KeychainManager.save()`

## ğŸ“Š Performance

### OtimizaÃ§Ãµes

- âœ… Async/await para operaÃ§Ãµes assÃ­ncronas
- âœ… @MainActor para UI updates
- âœ… Lazy loading de views
- âœ… Reuso de componentes

## ğŸ¤ Contribuindo

### Code Style

- Swift Style Guide da Apple
- SwiftLint (configurar se necessÃ¡rio)
- ComentÃ¡rios em portuguÃªs
- MARK para organizaÃ§Ã£o

### Commits

```bash
git commit -m "feat: adiciona tela de perfil"
git commit -m "fix: corrige bug no login"
git commit -m "test: adiciona testes para ProfileViewModel"
```

## ğŸ“ Notas da Semana 2

### Implementado por: Lucas (IOS-SENIOR-01)

**Entregas:**
- âœ… Setup do projeto iOS
- âœ… Arquitetura MVVM
- âœ… Telas de autenticaÃ§Ã£o
- âœ… IntegraÃ§Ã£o com backend
- âœ… Keychain para tokens
- âœ… Firebase configurado
- âœ… Testes unitÃ¡rios
- âœ… DocumentaÃ§Ã£o

**PrÃ³ximos Passos:**
1. Implementar funcionalidades do dashboard
2. Adicionar biometria
3. Implementar notificaÃ§Ãµes push
4. Modo offline com Core Data
5. Melhorar cobertura de testes

## ğŸ“ Suporte

Para dÃºvidas ou problemas:
- Consulte a documentaÃ§Ã£o do projeto
- Verifique os logs do Xcode
- Revise os testes unitÃ¡rios

## ğŸ“„ LicenÃ§a

